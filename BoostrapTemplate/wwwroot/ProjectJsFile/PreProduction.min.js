function startReload(){reloadTable();reloadInterval=setInterval(function(){reloadTable()},5e3)}function reloadTable(){$.ajax({url:"/DataVisulization/CheckIsAutoMode",type:"GET",dataType:"json",success:function(n){n==!0?($("#divFilter").hide(),$.ajax({url:"/DataVisulization/ReloadPreProOrder",type:"GET",dataType:"json",success:function(n){totalData=n;const t=$("#Table tbody");t.empty();var n=totalData;n.forEach(function(n){const i=n.status===1?"status-red":"";t.append("<tr class='"+i+"'><td><\/td><td id='PPSeqNo'>"+n.ppSeqNo+"<\/td><td>"+n.itemId+"<\/td><td>"+n.biwNo+"<\/td><td>"+n.vcode+"<\/td><td>"+n.modelCode+"<\/td><td>"+n.fileName+"<\/td><td>"+forDateTime(n.dateIimport)+"<\/td><\/tr>")})},error:function(n){console.error("Error fetching data:",n)}})):($("#divFilter").show(),clearInterval(reloadInterval))},error:function(n){console.error("Error fetching data:",n)}})}function forDateTime(n){var t=new Date(n.split("/").reverse().join("-")),i=`${t.getDate()}`.padStart(2,"0"),r=`${t.getMonth()+1}`.padStart(2,"0"),u=t.getFullYear(),f=t.getHours(),e=t.getMinutes(),o=t.getSeconds();return i+"/"+r+"/"+u+" "+f+":"+e+":"+o}function preback(){setTimeout("preback()",0);window.onunload=function(){null}}var reloadInterval,totalData=[];$(document).ready(function(){function u(){const n=t.rows(".selected").data().toArray();if(n.length===0){r.empty();return}const u=n.map(n=>parseInt(n[8])),s=u.every(n=>n===0),h=u.every(n=>n===1);if(r.empty(),s)r.append(o,f,e);else if(h){const n=$("<button>",{"class":"btn btn-success",text:"Release",click:function(){const n=confirm("Are you sure you want to Release these Hold orders?");n&&$.ajax({type:"POST",url:"/DataVisulization/ReleaseHold",dataType:"json",contentType:"application/json",data:JSON.stringify(i),success:function(n){n.status==="Released"?(alert("Hold Released Successfully."),window.location.reload()):(alert(n.message||"Unexpected error."),location.reload())},error:function(){alert("Failed to release Hold orders.")}})}});r.append(n)}}function s(){i=n.map(function(n){return{PPSeqNo:parseInt(n[1]),ItemId:n[2],BiwNo:n[3],Vcode:n[4],ModelCode:n[5]}})}function h(t){for(var i=0;i<n.length;i++)if(JSON.stringify(n[i])===JSON.stringify(t))return!0;return!1}function c(){var n=t.rows(".selected").count();$("#RowcountDisplay").text(`Selected ${n}`).append(" of total "+$("#Table tbody tr").length)}var f,e,o;startReload();$("#Table").DataTable({dom:"Blfrtip",ordering:!1,buttons:["excel"],columnDefs:[{orderable:!1,className:"select-checkbox",targets:0}],select:{style:"multi",selector:"td:first-child"},paging:!1});$("#select-all-checkbox").on("click",function(){$(this).is(":checked")?t.rows({page:"current"}).select():t.rows().deselect()});var n=[],i=[],t=$("#Table").DataTable(),r=$("#buttonContainer"),l=$("#DivDelete");$("#btnselect").click(function(){if($("#fromPpseq").val()==0||$("#fromPpseq").val()==""||$("#toPpseq").val()==0||$("#toPpseq").val()==""){alert("Enter Valid PPSeqNo!");location.reload();return}let l=$("#fromPpseq").val(),a=$("#toPpseq").val();if($("#Table tbody tr").each(function(){$(this).removeClass("selected");let n=parseInt($(this).find("#PPSeqNo").text());n>=l&&n<=a&&$(this).addClass("selected").data()}),c(),t.rows(".selected").count()>0){var v=t.rows(".selected").data();n=[];v.each(function(t,i){h(i)||n.push(t)});s();f=$("<button>",{"class":"btn btn-primary",text:"TRF Production",click:function(){var n=confirm("Are you sure you want to Transfer to Production this orders?");n?$.ajax({type:"POST",url:"/DataVisulization/TRFtoProduction",dataType:"json",contentType:"application/json",data:JSON.stringify(i),success:function(n){n.status==="DataRecived"&&(alert("Production Start"),window.location.reload(),window.location.href="/DataVisulization/Index");n.status==="error"&&(alert("Refresh Page "),location.reload());n.status==="Unauthorized"&&(alert(n.message),location.reload())}}):(alert("Order Transfer to Production canceled."),location.reload())}});e=$("<button>",{"class":"btnAbound",html:'<i class="fa fa-trash fa-lg"><\/i>',click:function(){var n=confirm("Are you sure you want to Delete this orders?");n?$.ajax({type:"POST",url:"/DataVisulization/IsDeleted",dataType:"json",contentType:"application/json",data:JSON.stringify(i),success:function(n){n.status==="DataDeleted"&&(alert("Order Abandoned Successfully."),window.location.reload());n.status==="error"&&(alert("Refresh Page "),location.reload());n.status==="Unauthorized"&&(alert(n.message),location.reload())}}):(alert("Order abandonment canceled."),location.reload())}});o=$("<button>",{"class":"btnAbound",html:'<i class="bi bi-stop-circle fs-3"><\/i>',click:function(){var n=confirm("Are you sure you want to Hold this orders?");n?$.ajax({type:"POST",url:"/DataVisulization/Hold",dataType:"json",contentType:"application/json",data:JSON.stringify(i),success:function(n){n.status==="DataHold"&&(alert("Order Hold Successfully."),window.location.reload());n.status==="error"&&(alert(n.message),alert("Refresh Page "),location.reload());n.status==="Unauthorized"&&(alert(n.message),location.reload())}}):(alert("Order abandonment canceled."),location.reload())}});u()}else r.empty()});t.on("select",function(r,l,a){if(a==="row"){c();var v=t.rows(".selected").data();n=[];v.each(function(t,i){h(i)||n.push(t)});s();u();console.log(n);console.log(i)}n.length>0&&(f=$("<button>",{"class":"btn btn-primary",text:"TRF Production",click:function(){var n=confirm("Are you sure you want to Transfer to Production this orders?");n?$.ajax({type:"POST",url:"/DataVisulization/TRFtoProduction",dataType:"json",contentType:"application/json",data:JSON.stringify(i),success:function(n){n.status==="DataRecived"&&(alert("Production Start"),window.location.reload(),window.location.href="/DataVisulization/Index");n.status==="error"&&(alert("Error Refresh Page "),location.reload());n.status==="Unauthorized"&&(alert(n.message),location.reload())}}):(alert("Order Transfer to Production canceled."),location.reload())}}),e=$("<button>",{"class":"btnAbound",html:'<i class="fa fa-trash fa-lg"><\/i>',click:function(){var n=confirm("Are you sure you want to Delete this orders?");n?$.ajax({type:"POST",url:"/DataVisulization/IsDeleted",dataType:"json",contentType:"application/json",data:JSON.stringify(i),success:function(n){n.status==="DataDeleted"&&(alert("Order Abandoned Successfully."),window.location.reload());n.status==="error"&&(alert(n.message),alert("Refresh Page "),location.reload());n.status==="Unauthorized"&&(alert(n.message),location.reload())}}):(alert("Order abandonment canceled."),location.reload())}}),o=$("<button>",{"class":"btnAbound",html:'<i class="bi bi-stop-circle fs-3"><\/i>',click:function(){var n=confirm("Are you sure you want to Hold this orders?");n?$.ajax({type:"POST",url:"/DataVisulization/Hold",dataType:"json",contentType:"application/json",data:JSON.stringify(i),success:function(n){n.status==="DataHold"&&(alert("Order Hold Successfully."),window.location.reload());n.status==="error"&&(alert(n.message),alert("Refresh Page "),location.reload());n.status==="Unauthorized"&&(alert(n.message),location.reload())}}):(alert("Order abandonment canceled."),location.reload())}}),u())});t.on("deselect",function(i,f,e){if(e==="row"){c();var o=t.rows(".selected").data();n=[];o.each(function(t,i){h(i)||n.push(t)});console.log(n);s();u();n.length===0&&r.empty()}});preback()});