function startReload(){reloadTable();reloadInterval=setInterval(function(){reloadTable()},5e3)}function reloadTable(){$.ajax({url:"/DataVisulization/CheckIsAutoMode",type:"GET",dataType:"json",success:function(n){n==!0?($("#divFilter").hide(),$.ajax({url:"/DataVisulization/ReloadPreProOrder",type:"GET",dataType:"json",success:function(n){totalData=n;const t=$("#Table tbody");t.empty();const i=n=>{const t=parseInt(n.status);return t===1?"status-red":t===100?"status-blue":""};totalData.forEach(function(n){const r=i(n);t.append("<tr class='"+r+"'><td><\/td><td id='PPSeqNo'>"+n.ppSeqNo+"<\/td><td>"+n.itemId+"<\/td><td>"+n.biwNo+"<\/td><td>"+n.vcode+"<\/td><td>"+n.modelCode+"<\/td><td>"+n.fileName+"<\/td><td>"+forDateTime(n.dateIimport)+"<\/td><\/tr>")})}})):($("#divFilter").show(),clearInterval(reloadInterval))}})}function reloadTableWithoutInterval(){$.ajax({url:"/DataVisulization/ReloadPreProOrder",type:"GET",dataType:"json",success:function(n){totalData=n;const t=$("#Table tbody");t.empty();const r=n=>{const t=parseInt(n.status);return t===1?"status-red":t===100?"status-blue":""};totalData.forEach(function(n){const r=parseInt(n.status);let i="";r===1&&(i="status-red");r===100&&(i="status-blue");const u=forDateTime(n.dateIimport),f=`<tr class="${i}">
                              <td><input type="checkbox" class="select-checkbox" /></td>
                              <td id="PPSeqNo">${n.ppSeqNo}</td>
                              <td>${n.itemId}</td>
                              <td>${n.biwNo}</td>
                              <td>${n.vcode}</td>
                              <td>${n.modelCode}</td>
                              <td>${n.fileName}</td>
                              <td>${u}</td>
                              <td class="col-status" id="Status">${n.status}</td>
                              </tr> `;t.append(f)});const i=sessionStorage.getItem("lastSelectedPPSeqNo");if(i){let n=null;$("#Table tbody tr").each(function(){const t=$(this).find("td").eq(1).text().trim();if(t===i)return n=$(this),!1});n&&($("#Table tbody tr").removeClass("selected"),n.addClass("selected"));sessionStorage.removeItem("lastSelectedPPSeqNo")}}})}function forDateTime(n){var t=new Date(n.split("/").reverse().join("-")),i=`${t.getDate()}`.padStart(2,"0"),r=`${t.getMonth()+1}`.padStart(2,"0"),u=t.getFullYear(),f=t.getHours(),e=t.getMinutes(),o=t.getSeconds();return i+"/"+r+"/"+u+" "+f+":"+e+":"+o}function preback(){setTimeout("preback()",0);window.onunload=function(){null}}var reloadInterval,totalData=[];$(document).ready(function(){function u(){const n=t.rows(".selected").data().toArray();if(n.length===0){r.empty();return}const u=n.map(n=>parseInt(n[8])),f=u.every(n=>n===0),e=u.every(n=>n===1);if(r.empty(),f)r.append(l,h,c);else if(e){const n=$("<button>",{"class":"btn btn-success",text:"Release Orders",click:function(){const n=confirm("Are you sure you want to Release these Hold orders?");n&&$.ajax({type:"POST",url:"/DataVisulization/ReleaseHold",dataType:"json",contentType:"application/json",data:JSON.stringify(i),success:function(n){n.status==="Released"?(alert("Hold Released Successfully."),window.location.reload()):(alert(n.message||"Unexpected error."),location.reload())},error:function(){alert("Failed to release Hold orders.")}})}});r.append(n)}}function f(){i=n.map(function(n){return{PPSeqNo:parseInt(n[1]),ItemId:n[2],BiwNo:n[3],Vcode:n[4],ModelCode:n[5]}})}function a(){const n=$("#Table tbody"),t=n.find("tr.selected");if(t.length<1){n.hasClass("ui-sortable")&&n.sortable("destroy");return}n.hasClass("ui-sortable")&&n.sortable("destroy");n.sortable({items:"tr",axis:"y",cancel:"tr:not(.selected)",helper:function(n,t){const r=t.children(),i=t.clone();return i.children().each(function(n){$(this).width(r.eq(n).width())}),i},start:function(n,t){t.item.addClass("dragging")},stop:function(n,t){t.item.removeClass("dragging")}})}function e(){h=$("<button>",{"class":"btn btn-primary",text:"Transfer To Production",click:function(){var n=confirm("Are you sure you want to Transfer to Production these orders?");n?$.ajax({type:"POST",url:"/DataVisulization/TRFtoProduction",dataType:"json",contentType:"application/json",data:JSON.stringify(i),success:function(n){n.status==="DataRecived"&&(alert("Production Start"),window.location.reload(),window.location.href="/DataVisulization/Index");n.status==="error"&&(alert("Error Refresh Page "),location.reload());n.status==="Unauthorized"&&(alert(n.message),location.reload())}}):(alert("Order Transfer to Production canceled."),location.reload())}});c=$("<button>",{"class":"btnAbound",html:'<i class="fa fa-trash fa-lg"><\/i>',title:"Delete the orders",click:function(){var n=confirm("Are you sure you want to Delete this orders?");n?$.ajax({type:"POST",url:"/DataVisulization/IsDeleted",dataType:"json",contentType:"application/json",data:JSON.stringify(i),success:function(n){n.status==="DataDeleted"&&(alert("Order Abandoned Successfully."),window.location.reload());n.status==="error"&&(alert(n.message),alert("Refresh Page "),location.reload());n.status==="Unauthorized"&&(alert(n.message),location.reload())}}):(alert("Order abandonment canceled."),location.reload())}});l=$("<button>",{"class":"btnAbound btn btn-danger",html:'<i class="bi bi-stop-circle fs-3"><\/i>',title:"Hold the orders",click:function(){var n=confirm("Are you sure you want to Hold these orders?");n?$.ajax({type:"POST",url:"/DataVisulization/Hold",dataType:"json",contentType:"application/json",data:JSON.stringify(i),success:function(n){n.status==="DataHold"&&(alert("Order Hold Successfully."),window.location.reload());n.status==="error"&&(alert(n.message),alert("Refresh Page "),location.reload());n.status==="Unauthorized"&&(alert(n.message),location.reload())}}):(alert("Order abandonment canceled."),location.reload())}})}function o(t){for(var i=0;i<n.length;i++)if(JSON.stringify(n[i])===JSON.stringify(t))return!0;return!1}function s(){var n=t.rows(".selected").count();$("#RowcountDisplay").text(`Selected ${n}`).append(" of total "+$("#Table tbody tr").length)}var h,c,l;startReload();$("#Table").DataTable({dom:"Blfrtip",ordering:!1,buttons:["excel"],columnDefs:[{orderable:!1,className:"select-checkbox",targets:0}],select:{style:"multi",selector:"td:first-child"},paging:!1});$("#select-all-checkbox").on("click",function(){$(this).is(":checked")?(t.rows({page:"current"}).deselect(),t.rows({page:"current"}).every(function(){var n=this.data();n[8]!=="1"&&this.select()})):t.rows({page:"current"}).deselect()});var n=[],i=[],t=$("#Table").DataTable(),r=$("#buttonContainer"),v=$("#DivDelete");$("#btnselect").click(function(){if($("#fromPpseq").val()==0||$("#fromPpseq").val()==""||$("#toPpseq").val()==0||$("#toPpseq").val()==""){alert("Enter Valid PPSeqNo!");location.reload();return}let i=$("#fromPpseq").val(),h=$("#toPpseq").val();if($("#Table tbody tr").each(function(){let n=$(this);n.removeClass("selected");let t=parseInt(n.find("#PPSeqNo").text()),r=n.find("#Status").text().trim();t>=i&&t<=h&&r!=="1"&&n.addClass("selected")}),s(),t.rows(".selected").count()>0){var c=t.rows(".selected").data();n=[];c.each(function(t,i){o(i)||n.push(t)});f();e();u()}else r.empty()});t.on("select",function(r,h,c){if(c==="row"){s();a();var l=t.rows(".selected").data();n=[];l.each(function(t,i){o(i)||n.push(t)});f();u();console.log(n);console.log(i)}n.length>0&&(e(),u())});t.on("deselect",function(h,c,l){if(l==="row"){s();var a=t.rows(".selected").data();n=[];a.each(function(t,i){o(i)||n.push(t)});f();e();u();n.length===0&&r.empty();console.log(n);console.log(i)}});preback()});